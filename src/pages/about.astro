---
import Layout from "../layouts/Layout.astro";
import PageTitle from "../components/shared/page/PageTitle";
import PageContainer from "../components/shared/page/PageContainer";
import AboutSnsLinks from "../components/features/about/AboutSnsLinks";
import AboutInterests from "../components/features/about/AboutInterests.astro";
import AboutOrganizations from "../components/features/about/AboutOrganizations.astro";
import AboutQualifications from "../components/features/about/AboutQualifications.astro";
import { getAllAbout, type AboutItem } from "../lib/microcms";
import "../components/shared/page/page-title.css";
import "../components/shared/page/page-container.css";
import "../components/features/about/about-sns-links.css";

// microCMSからデータを取得
let aboutItems: AboutItem[] = [];
try {
  const response = await getAllAbout();
  aboutItems = response.contents;
} catch (error) {
  // 環境変数が設定されていない場合は空配列を使用
  console.error("Failed to fetch about data:", error);
}

// genreで分類
const favoriteItems = aboutItems.filter(item => item.genre.includes("favorite-item"));
const favoriteCoffees = aboutItems.filter(item => item.genre.includes("favorite-coffee"));
const favoriteFlavors = aboutItems.filter(item => item.genre.includes("favorite-flavor"));
const interests = aboutItems.filter(item => item.genre.includes("interest"));
const organizations = aboutItems.filter(item => item.genre.includes("organization"));
const certifications = aboutItems.filter(item => item.genre.includes("certification"));
---

<Layout title="About">
    <PageContainer variant="about">
        <PageTitle title="ABOUT" pageType="about" client:load />
        <div class="content-grid">
            <AboutInterests
                favoriteItems={favoriteItems}
                favoriteCoffees={favoriteCoffees}
                favoriteFlavors={favoriteFlavors}
                interests={interests}
            />
            <AboutOrganizations organizations={organizations} />
            <AboutQualifications certifications={certifications} />
        </div>

        <AboutSnsLinks client:load />
    </PageContainer>
</Layout>

<style>
    .content-grid {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        margin-top: 2rem;
    }

    @media (width <= 48rem) {
        .content-grid {
            gap: 1.5rem;
        }
    }
</style>

